'use strict';var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[typeof Symbol==='function'?Symbol.iterator:'@@iterator'](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if((typeof Symbol==='function'?Symbol.iterator:'@@iterator')in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr);}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var assert=require('assert');var crypto=require('crypto');var debug=require('debug')('Metro:Bundler');var emptyFunction=require('fbjs/lib/emptyFunction');var fs=require('fs');var Transformer=require('../JSTransformer');var Resolver=require('../Resolver');var Bundle=require('./Bundle');var HMRBundle=require('./HMRBundle');var ModuleTransport=require('../lib/ModuleTransport');var imageSize=require('image-size');var path=require('path');var denodeify=require('denodeify');var defaults=require('../defaults');var toLocalPath=require('../node-haste/lib/toLocalPath');var createNumericModuleIdFactory=require('../lib/createNumericModuleIdFactory');var createStableModuleIdFactory=require('../lib/createStableModuleIdFactory');var _require=require('./util'),generateAssetTransformResult=_require.generateAssetTransformResult,isAssetTypeAnImage=_require.isAssetTypeAnImage;var _require2=require('path'),pathSeparator=_require2.sep,joinPath=_require2.join,pathDirname=_require2.dirname,extname=_require2.extname;var VERSION=require('../../package.json').version;var sizeOf=denodeify(imageSize);var _require3=require('../Logger'),createActionStartEntry=_require3.createActionStartEntry,createActionEndEntry=_require3.createActionEndEntry,log=_require3.log;var hasOwnProperty=Object.hasOwnProperty;var Bundler=function(){function Bundler(opts){var _this=this;_classCallCheck(this,Bundler);this._opts=opts;opts.projectRoots.forEach(verifyRootExists);var transformModuleStr=fs.readFileSync(opts.transformModulePath);var transformModuleHash=crypto.createHash('sha1').update(transformModuleStr).digest('hex');var stableProjectRoots=opts.projectRoots.map(function(p){return path.relative(path.join(__dirname,'../../../..'),p);});var cacheKeyParts=['metro-bundler-cache',VERSION,opts.cacheVersion,stableProjectRoots.join(',').split(pathSeparator).join('-'),transformModuleHash];var getCacheKey=function getCacheKey(options){return'';};if(opts.transformModulePath){var _transformer=require(opts.transformModulePath);if(typeof _transformer.getCacheKey!=='undefined'){getCacheKey=_transformer.getCacheKey;}}var transformCacheKey=crypto.createHash('sha1').update(cacheKeyParts.join('$')).digest('hex');debug('Using transform cache key "'+transformCacheKey+'"');this._transformer=new Transformer(opts.transformModulePath,opts.maxWorkers,{stdoutChunk:function stdoutChunk(chunk){return opts.reporter.update({type:'worker_stdout_chunk',chunk:chunk});},stderrChunk:function stderrChunk(chunk){return opts.reporter.update({type:'worker_stderr_chunk',chunk:chunk});}},opts.workerPath);var getTransformCacheKey=function getTransformCacheKey(options){return transformCacheKey+getCacheKey(options);};this._resolverPromise=Resolver.load({assetExts:opts.assetExts,assetRegistryPath:opts.assetRegistryPath,blacklistRE:opts.blacklistRE,extraNodeModules:opts.extraNodeModules,getPolyfills:opts.getPolyfills,getTransformCacheKey:getTransformCacheKey,globalTransformCache:opts.globalTransformCache,hasteImpl:opts.hasteImpl,maxWorkers:opts.maxWorkers,minifyCode:this._transformer.minify,postMinifyProcess:this._opts.postMinifyProcess,platforms:new Set(opts.platforms),polyfillModuleNames:opts.polyfillModuleNames,projectRoots:opts.projectRoots,providesModuleNodeModules:opts.providesModuleNodeModules||defaults.providesModuleNodeModules,reporter:opts.reporter,resetCache:opts.resetCache,sourceExts:opts.sourceExts,transformCode:function transformCode(module,code,transformCodeOptions){return _this._transformer.transformFile(module.path,module.localPath,code,transformCodeOptions);},transformCache:opts.transformCache,watch:opts.watch});this._projectRoots=opts.projectRoots;this._assetServer=opts.assetServer;this._getTransformOptions=opts.getTransformOptions;}_createClass(Bundler,[{key:'end',value:function end(){this._transformer.kill();return this._resolverPromise.then(function(resolver){return resolver.getDependencyGraph().getWatcher().end();});}},{key:'bundle',value:function bundle(options){var _this2=this;var dev=options.dev,minify=options.minify,unbundle=options.unbundle;var postProcessBundleSourcemap=this._opts.postProcessBundleSourcemap;return this._resolverPromise.then(function(resolver){return resolver.getModuleSystemDependencies({dev:dev,unbundle:unbundle});}).then(function(moduleSystemDeps){return _this2._bundle(_extends({},options,{bundle:new Bundle({dev:dev,minify:minify,sourceMapUrl:options.sourceMapUrl,postProcessBundleSourcemap:postProcessBundleSourcemap}),moduleSystemDeps:moduleSystemDeps}));});}},{key:'_sourceHMRURL',value:function _sourceHMRURL(platform,hmrpath){return this._hmrURL('',platform,'bundle',hmrpath);}},{key:'_sourceMappingHMRURL',value:function _sourceMappingHMRURL(platform,hmrpath){return this._hmrURL('//# sourceURL=',platform,'map',hmrpath);}},{key:'_hmrURL',value:function _hmrURL(prefix,platform,extensionOverride,filePath){var matchingRoot=this._projectRoots.find(function(root){return filePath.startsWith(root);});if(!matchingRoot){throw new Error('No matching project root for '+filePath);}if(pathSeparator==='\\'){filePath=filePath.replace(/\\/g,'/');}var extensionStart=filePath.lastIndexOf('.');var resource=filePath.substring(matchingRoot.length,extensionStart!==-1?extensionStart:undefined);return prefix+resource+'.'+extensionOverride+'?'+'platform='+(platform||'')+'&runModule=false&entryModuleOnly=true';}},{key:'hmrBundle',value:function hmrBundle(options,host,port){return this._bundle(_extends({},options,{bundle:new HMRBundle({sourceURLFn:this._sourceHMRURL.bind(this,options.platform),sourceMappingURLFn:this._sourceMappingHMRURL.bind(this,options.platform)}),hot:true,dev:true}));}},{key:'_bundle',value:function _bundle(_ref){var _this3=this;var assetPlugins=_ref.assetPlugins,bundle=_ref.bundle,dev=_ref.dev,entryFile=_ref.entryFile,entryModuleOnly=_ref.entryModuleOnly,generateSourceMaps=_ref.generateSourceMaps,hot=_ref.hot,isolateModuleIDs=_ref.isolateModuleIDs,minify=_ref.minify,_ref$moduleSystemDeps=_ref.moduleSystemDeps,moduleSystemDeps=_ref$moduleSystemDeps===undefined?[]:_ref$moduleSystemDeps,onProgress=_ref.onProgress,platform=_ref.platform,resolutionResponse=_ref.resolutionResponse,runBeforeMainModule=_ref.runBeforeMainModule,runModule=_ref.runModule,unbundle=_ref.unbundle,_ref$useStableId=_ref.useStableId,useStableId=_ref$useStableId===undefined?false:_ref$useStableId,_ref$startId=_ref.startId,startId=_ref$startId===undefined?0:_ref$startId,excludedModules=_ref.excludedModules;var onResolutionResponse=function onResolutionResponse(response){bundle.setMainModuleId(response.getModuleId(getMainModule(response)));if(entryModuleOnly&&entryFile){response.dependencies=response.dependencies.filter(function(module){return module.path.endsWith(entryFile||'');});}else if(excludedModules){response.dependencies=response.dependencies.filter(function(dep){return!excludedModules[dep.getName()];});}else{response.dependencies=moduleSystemDeps.concat(response.dependencies);}};var finalizeBundle=function finalizeBundle(_ref2){var finalBundle=_ref2.bundle,transformedModules=_ref2.transformedModules,response=_ref2.response;return _this3._resolverPromise.then(function(resolver){return Promise.all(transformedModules.map(function(_ref3){var module=_ref3.module,transformed=_ref3.transformed;return finalBundle.addModule(resolver,response,module,transformed);}));}).then(function(){return Promise.all(runBeforeMainModule?runBeforeMainModule.map(function(name){return _this3.getModuleForName(name);}):[]);}).then(function(runBeforeMainModules){finalBundle.finalize({runModule:runModule,runBeforeMainModule:runBeforeMainModules.map(function(module){var name=module.getName();return excludedModules&&excludedModules[name]&&excludedModules[name].id||response.getModuleId(module);}),allowUpdates:_this3._opts.allowBundleUpdates});return finalBundle;});};return this._buildBundle({entryFile:entryFile,dev:dev,minify:minify,platform:platform,bundle:bundle,hot:hot,unbundle:unbundle,resolutionResponse:resolutionResponse,onResolutionResponse:onResolutionResponse,finalizeBundle:finalizeBundle,isolateModuleIDs:isolateModuleIDs,generateSourceMaps:generateSourceMaps,assetPlugins:assetPlugins,startId:startId,useStableId:useStableId,excludedModules:excludedModules,onProgress:onProgress});}},{key:'_buildBundle',value:function _buildBundle(_ref4){var _this4=this;var entryFile=_ref4.entryFile,dev=_ref4.dev,minify=_ref4.minify,platform=_ref4.platform,bundle=_ref4.bundle,hot=_ref4.hot,unbundle=_ref4.unbundle,resolutionResponse=_ref4.resolutionResponse,isolateModuleIDs=_ref4.isolateModuleIDs,generateSourceMaps=_ref4.generateSourceMaps,assetPlugins=_ref4.assetPlugins,startId=_ref4.startId,useStableId=_ref4.useStableId,excludedModules=_ref4.excludedModules,_ref4$onResolutionRes=_ref4.onResolutionResponse,onResolutionResponse=_ref4$onResolutionRes===undefined?emptyFunction:_ref4$onResolutionRes,_ref4$onModuleTransfo=_ref4.onModuleTransformed,onModuleTransformed=_ref4$onModuleTransfo===undefined?emptyFunction:_ref4$onModuleTransfo,_ref4$finalizeBundle=_ref4.finalizeBundle,finalizeBundle=_ref4$finalizeBundle===undefined?emptyFunction:_ref4$finalizeBundle,_ref4$onProgress=_ref4.onProgress,onProgress=_ref4$onProgress===undefined?emptyFunction:_ref4$onProgress;var transformingFilesLogEntry=log(createActionStartEntry({action_name:'Transforming files',entry_point:entryFile,environment:dev?'dev':'prod'}));if(!resolutionResponse){resolutionResponse=this.getDependencies({entryFile:entryFile,rootEntryFile:entryFile,dev:dev,platform:platform,hot:hot,onProgress:onProgress,minify:minify,isolateModuleIDs:isolateModuleIDs,startId:startId,useStableId:useStableId,excludedModules:excludedModules,generateSourceMaps:unbundle||minify||generateSourceMaps,prependPolyfills:excludedModules?false:true});}return Promise.all([this._resolverPromise,resolutionResponse]).then(function(_ref5){var _ref6=_slicedToArray(_ref5,2),resolver=_ref6[0],response=_ref6[1];bundle.setRamGroups(response.options.ramGroups);log(createActionEndEntry(transformingFilesLogEntry));onResolutionResponse(response);var entryFilePath=void 0;if(response.dependencies.length>1){var numModuleSystemDependencies=excludedModules?0:resolver.getModuleSystemDependencies({dev:dev,unbundle:unbundle}).length;var dependencyIndex=(response.numPrependedDependencies||0)+numModuleSystemDependencies;if(dependencyIndex in response.dependencies){entryFilePath=response.dependencies[dependencyIndex].path;}}var modulesByTransport=new Map();var toModuleTransport=function toModuleTransport(module){return _this4._toModuleTransport({module:module,bundle:bundle,entryFilePath:entryFilePath,assetPlugins:assetPlugins,options:response.options,getModuleId:response.getModuleId,dependencyPairs:response.getResolvedDependencyPairs(module)}).then(function(transformed){modulesByTransport.set(transformed,module);onModuleTransformed({module:module,response:response,bundle:bundle,transformed:transformed});return transformed;});};var p=_this4._opts.postProcessModules;var postProcess=p?function(modules){return p(modules,entryFile,{dev:dev,minify:minify,platform:platform});}:null;return Promise.all(response.dependencies.map(toModuleTransport)).then(postProcess).then(function(moduleTransports){var transformedModules=moduleTransports.map(function(transformed){return{module:modulesByTransport.get(transformed),transformed:transformed};});return finalizeBundle({bundle:bundle,transformedModules:transformedModules,response:response});}).then(function(){return bundle;});});}},{key:'getShallowDependencies',value:function getShallowDependencies(_ref7){var entryFile=_ref7.entryFile,rootEntryFile=_ref7.rootEntryFile,platform=_ref7.platform,_ref7$dev=_ref7.dev,dev=_ref7$dev===undefined?true:_ref7$dev,_ref7$minify=_ref7.minify,minify=_ref7$minify===undefined?!dev:_ref7$minify,_ref7$hot=_ref7.hot,hot=_ref7$hot===undefined?false:_ref7$hot,_ref7$generateSourceM=_ref7.generateSourceMaps,generateSourceMaps=_ref7$generateSourceM===undefined?false:_ref7$generateSourceM,transformerOptions=_ref7.transformerOptions;var notNullOptions;return regeneratorRuntime.async(function getShallowDependencies$(_context){while(1){switch(_context.prev=_context.next){case 0:if(transformerOptions){_context.next=4;break;}_context.next=3;return regeneratorRuntime.awrap(this.getTransformOptions(rootEntryFile,{dev:dev,generateSourceMaps:generateSourceMaps,hot:hot,minify:minify,platform:platform,prependPolyfills:false}));case 3:transformerOptions=_context.sent.transformer;case 4:notNullOptions=transformerOptions;return _context.abrupt('return',this._resolverPromise.then(function(resolver){return resolver.getShallowDependencies(entryFile,notNullOptions);}));case 6:case'end':return _context.stop();}}},null,this);}},{key:'getModuleForPath',value:function getModuleForPath(entryFile){return this._resolverPromise.then(function(resolver){return resolver.getModuleForPath(entryFile);});}},{key:'getModuleForName',value:function getModuleForName(name){return this._resolverPromise.then(function(resolver){return resolver.getModuleForName(name);});}},{key:'getDependencies',value:function getDependencies(_ref8){var entryFile=_ref8.entryFile,platform=_ref8.platform,_ref8$dev=_ref8.dev,dev=_ref8$dev===undefined?true:_ref8$dev,_ref8$minify=_ref8.minify,minify=_ref8$minify===undefined?!dev:_ref8$minify,_ref8$hot=_ref8.hot,hot=_ref8$hot===undefined?false:_ref8$hot,_ref8$recursive=_ref8.recursive,recursive=_ref8$recursive===undefined?true:_ref8$recursive,_ref8$generateSourceM=_ref8.generateSourceMaps,generateSourceMaps=_ref8$generateSourceM===undefined?false:_ref8$generateSourceM,_ref8$startId=_ref8.startId,startId=_ref8$startId===undefined?0:_ref8$startId,_ref8$useStableId=_ref8.useStableId,useStableId=_ref8$useStableId===undefined?false:_ref8$useStableId,excludedModules=_ref8.excludedModules,_ref8$isolateModuleID=_ref8.isolateModuleIDs,isolateModuleIDs=_ref8$isolateModuleID===undefined?false:_ref8$isolateModuleID,rootEntryFile=_ref8.rootEntryFile,prependPolyfills=_ref8.prependPolyfills,onProgress=_ref8.onProgress;var bundlingOptions,resolver,getModuleId,response;return regeneratorRuntime.async(function getDependencies$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return regeneratorRuntime.awrap(this.getTransformOptions(rootEntryFile,{dev:dev,platform:platform,hot:hot,generateSourceMaps:generateSourceMaps,minify:minify,prependPolyfills:prependPolyfills}));case 2:bundlingOptions=_context2.sent;_context2.next=5;return regeneratorRuntime.awrap(this._resolverPromise);case 5:resolver=_context2.sent;getModuleId=void 0;if(useStableId){if(!this._getStableModuleId){this._getStableModuleId=createStableModuleIdFactory();}getModuleId=isolateModuleIDs?createStableModuleIdFactory():this._getStableModuleId;}else{if(!this._getNumericModuleId){this._getNumericModuleId=createNumericModuleIdFactory(startId);}getModuleId=isolateModuleIDs?createNumericModuleIdFactory(startId):this._getNumericModuleId;}_context2.next=10;return regeneratorRuntime.awrap(resolver.getDependencies(entryFile,{dev:dev,platform:platform,recursive:recursive,prependPolyfills:prependPolyfills},bundlingOptions,onProgress,function(module){var name=module.getName();return excludedModules&&excludedModules[name]&&excludedModules[name].id||getModuleId(module);}));case 10:response=_context2.sent;return _context2.abrupt('return',response);case 12:case'end':return _context2.stop();}}},null,this);}},{key:'getOrderedDependencyPaths',value:function getOrderedDependencyPaths(_ref9){var _this5=this;var entryFile=_ref9.entryFile,dev=_ref9.dev,platform=_ref9.platform,minify=_ref9.minify,generateSourceMaps=_ref9.generateSourceMaps,excludedModules=_ref9.excludedModules;return this.getDependencies({entryFile:entryFile,rootEntryFile:entryFile,dev:dev,platform:platform,minify:minify,generateSourceMaps:generateSourceMaps,excludedModules:excludedModules,prependPolyfills:true}).then(function(_ref10){var dependencies=_ref10.dependencies;var ret=[];var promises=[];var placeHolder={};dependencies.forEach(function(dep){if(dep.isAsset()){var localPath=toLocalPath(_this5._projectRoots,dep.path);promises.push(_this5._assetServer.getAssetData(localPath,platform));ret.push(placeHolder);}else{ret.push(dep.path);}});return Promise.all(promises).then(function(assetsData){assetsData.forEach(function(_ref11){var files=_ref11.files;var index=ret.indexOf(placeHolder);ret.splice.apply(ret,[index,1].concat(_toConsumableArray(files)));});return ret;});});}},{key:'_toModuleTransport',value:function _toModuleTransport(_ref12){var module=_ref12.module,bundle=_ref12.bundle,entryFilePath=_ref12.entryFilePath,options=_ref12.options,getModuleId=_ref12.getModuleId,dependencyPairs=_ref12.dependencyPairs,assetPlugins=_ref12.assetPlugins;var moduleTransport=void 0;var moduleId=getModuleId(module);var transformOptions=options.transformer;if(module.isAsset()){moduleTransport=this._generateAssetModule(bundle,module,moduleId,assetPlugins,transformOptions.platform);}if(moduleTransport){return Promise.resolve(moduleTransport);}return module.read(transformOptions).then(function(_ref13){var code=_ref13.code,dependencies=_ref13.dependencies,dependencyOffsets=_ref13.dependencyOffsets,map=_ref13.map,source=_ref13.source;var name=module.getName();var preloadedModules=options.preloadedModules;var isPolyfill=module.isPolyfill();var preloaded=module.path===entryFilePath||isPolyfill||preloadedModules&&hasOwnProperty.call(preloadedModules,module.path);return new ModuleTransport({name:name,id:moduleId,code:code,map:map,meta:{dependencies:dependencies,dependencyOffsets:dependencyOffsets,preloaded:preloaded,dependencyPairs:dependencyPairs},polyfill:isPolyfill,sourceCode:source,sourcePath:module.path});});}},{key:'generateAssetObjAndCode',value:function generateAssetObjAndCode(module,assetPlugins){var _this6=this;var platform=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var localPath=toLocalPath(this._projectRoots,module.path);var assetUrlPath=joinPath('/assets',pathDirname(localPath));if(pathSeparator==='\\'){assetUrlPath=assetUrlPath.replace(/\\/g,'/');}var isImage=isAssetTypeAnImage(extname(module.path).slice(1));return this._assetServer.getAssetData(localPath,platform).then(function(assetData){return Promise.all([isImage?sizeOf(assetData.files[0]):null,assetData]);}).then(function(res){var dimensions=res[0];var assetData=res[1];var scale=assetData.scales[0];var asset={__packager_asset:true,fileSystemLocation:pathDirname(module.path),httpServerLocation:assetUrlPath,width:dimensions?dimensions.width/scale:undefined,height:dimensions?dimensions.height/scale:undefined,scales:assetData.scales,files:assetData.files,hash:assetData.hash,name:assetData.name,type:assetData.type};return _this6._applyAssetPlugins(assetPlugins,asset);}).then(function(asset){var _generateAssetTransfo=generateAssetTransformResult(_this6._opts.assetRegistryPath,asset),code=_generateAssetTransfo.code,dependencies=_generateAssetTransfo.dependencies,dependencyOffsets=_generateAssetTransfo.dependencyOffsets;return{asset:asset,code:code,meta:{dependencies:dependencies,dependencyOffsets:dependencyOffsets,preloaded:null}};});}},{key:'_applyAssetPlugins',value:function _applyAssetPlugins(assetPlugins,asset){var _this7=this;if(!assetPlugins.length){return asset;}var _assetPlugins=_toArray(assetPlugins),currentAssetPlugin=_assetPlugins[0],remainingAssetPlugins=_assetPlugins.slice(1);var assetPluginFunction=require(currentAssetPlugin);var result=assetPluginFunction(asset);if(typeof result.then==='function'){return result.then(function(resultAsset){return _this7._applyAssetPlugins(remainingAssetPlugins,resultAsset);});}else{return this._applyAssetPlugins(remainingAssetPlugins,result);}}},{key:'_generateAssetModule',value:function _generateAssetModule(bundle,module,moduleId){var assetPlugins=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var platform=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;return this.generateAssetObjAndCode(module,assetPlugins,platform).then(function(_ref14){var asset=_ref14.asset,code=_ref14.code,meta=_ref14.meta;bundle.addAsset(asset);return new ModuleTransport({name:module.getName(),id:moduleId,code:code,meta:meta,sourceCode:code,sourcePath:module.path,virtual:true});});}},{key:'getTransformOptions',value:function getTransformOptions(mainModuleName,options){var _this8=this;var getDependencies,dev,hot,platform,extraOptions,_extraOptions$transfo,transform;return regeneratorRuntime.async(function getTransformOptions$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:getDependencies=function getDependencies(entryFile){return _this8.getDependencies(_extends({},options,{enableBabelRCLookup:_this8._opts.enableBabelRCLookup,entryFile:entryFile,projectRoots:_this8._projectRoots,rootEntryFile:entryFile,excludedModules:excludedModules,prependPolyfills:false})).then(function(r){return r.dependencies.map(function(d){return d.path;});});};dev=options.dev,hot=options.hot,platform=options.platform;if(!this._getTransformOptions){_context3.next=8;break;}_context3.next=5;return regeneratorRuntime.awrap(this._getTransformOptions([mainModuleName],{dev:dev,hot:hot,platform:platform},getDependencies));case 5:_context3.t0=_context3.sent;_context3.next=9;break;case 8:_context3.t0={};case 9:extraOptions=_context3.t0;_extraOptions$transfo=extraOptions.transform,transform=_extraOptions$transfo===undefined?{}:_extraOptions$transfo;return _context3.abrupt('return',{transformer:{dev:dev,minify:options.minify,platform:platform,transform:{enableBabelRCLookup:this._opts.enableBabelRCLookup,dev:dev,generateSourceMaps:options.generateSourceMaps,hot:hot,inlineRequires:transform.inlineRequires||false,platform:platform,projectRoot:this._projectRoots[0]}},preloadedModules:extraOptions.preloadedModules,ramGroups:extraOptions.ramGroups});case 12:case'end':return _context3.stop();}}},null,this);}},{key:'getResolver',value:function getResolver(){return this._resolverPromise;}}]);return Bundler;}();function verifyRootExists(root){assert(fs.statSync(root).isDirectory(),'Root has to be a valid directory');}function getMainModule(_ref15){var dependencies=_ref15.dependencies,_ref15$numPrependedDe=_ref15.numPrependedDependencies,numPrependedDependencies=_ref15$numPrependedDe===undefined?0:_ref15$numPrependedDe;return dependencies[numPrependedDependencies];}module.exports=Bundler;
